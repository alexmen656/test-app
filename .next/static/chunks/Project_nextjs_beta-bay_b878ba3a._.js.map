{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/pe/Project/nextjs/beta-bay/hooks/useAuth.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  image: string;\n  team: string;\n}\n\nexport function useAuth() {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isCheckingAuth, setIsCheckingAuth] = useState(false); // Prevent multiple parallel checks\n\n  useEffect(() => {\n    // Add a small delay to ensure localStorage is available\n    const timer = setTimeout(() => {\n      console.log('useAuth: Initial check - localStorage available =', typeof(Storage) !== \"undefined\");\n      console.log('useAuth: Current tokens in storage =', {\n        authToken: localStorage.getItem('authToken') ? 'present' : 'missing',\n        authTokenTime: localStorage.getItem('authTokenTime')\n      });\n      checkAuthStatus();\n    }, 50);\n    \n    return () => clearTimeout(timer);\n  }, []);\n\n  // Remove storage event listener as it causes race conditions\n  // useEffect(() => {\n  //   const handleStorageChange = (e: StorageEvent) => {\n  //     if (e.key === 'authToken') {\n  //       console.log('useAuth: Token changed in storage, rechecking auth...');\n  //       checkAuthStatus();\n  //     }\n  //   };\n\n  //   window.addEventListener('storage', handleStorageChange);\n  //   return () => window.removeEventListener('storage', handleStorageChange);\n  // }, []);\n\n  const checkAuthStatus = async () => {\n    // Prevent multiple parallel auth checks\n    if (isCheckingAuth) {\n      console.log('useAuth: Auth check already in progress, skipping...');\n      return;\n    }\n\n    setIsCheckingAuth(true);\n    \n    try {\n      const token = localStorage.getItem('authToken');\n      \n      console.log('useAuth: Checking auth status, token =', token ? 'present' : 'missing');\n      console.log('useAuth: Token value =', token ? token.substring(0, 20) + '...' : 'null');\n      \n      if (!token) {\n        console.log('useAuth: No token found');\n        setUser(null);\n        setError(null);\n        setIsLoading(false);\n        return;\n      }\n\n      const backendUrl = 'https://betabay.vercel.app';\n      \n      console.log('useAuth: Making request to backend...');\n      const response = await fetch(`${backendUrl}/api/user`, {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      console.log('useAuth: Response status =', response.status);\n\n      if (response.ok) {\n        const userData = await response.json();\n        console.log('useAuth: User data received =', userData);\n        setUser(userData);\n        \n        // Speichere Slack-Profildaten im localStorage\n        if (userData.name) {\n          localStorage.setItem('betabay_username', userData.name);\n        }\n        \n        if (userData.image) {\n          localStorage.setItem('betabay_profile_image', userData.image);\n        }\n        \n        if (userData.id) {\n          localStorage.setItem('betabay_user_id', userData.id);\n        }\n        \n        setError(null);\n      } else {\n        console.log('useAuth: Auth request failed, status =', response.status);\n        if (response.status === 401) {\n          console.log('useAuth: Token invalid (401), clearing user but keeping token for debugging');\n          setUser(null);\n          setError('Session expired');\n        } else {\n          console.log('useAuth: Network error, keeping token and user state');\n          setError('Network error');\n        }\n      }\n    } catch (err) {\n      console.error('Auth check failed:', err);\n      setError('Authentication error');\n      // Don't modify user state on network errors\n    } finally {\n      setIsLoading(false);\n      setIsCheckingAuth(false);\n    }\n  };\n\n  const logout = async () => {\n    console.log('useAuth: Logging out...');\n    try {\n      const token = localStorage.getItem('authToken');\n      const backendUrl = 'https://betabay.vercel.app';\n      \n      if (token) {\n        await fetch(`${backendUrl}/api/logout`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json',\n          },\n        });\n      }\n    } catch (err) {\n      console.error('Logout error:', err);\n    } finally {\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('authTokenTime');\n      setUser(null);\n      setError(null);\n      setIsLoading(false);\n    }\n  };\n\n  const refreshAuth = () => {\n    console.log('useAuth: Manual refresh requested');\n    checkAuthStatus();\n  };\n\n  const setAuthToken = (token: string) => {\n    console.log('useAuth: Setting new auth token, length =', token.length);\n    \n    // Prevent race conditions during token setting\n    if (isCheckingAuth) {\n      console.log('useAuth: Auth check in progress, waiting...');\n      setTimeout(() => setAuthToken(token), 100);\n      return;\n    }\n    \n    try {\n      // Store token with additional verification\n      localStorage.setItem('authToken', token);\n      \n      // Verify it was stored\n      const storedToken = localStorage.getItem('authToken');\n      console.log('useAuth: Token stored successfully =', storedToken === token);\n      \n      // Also store a timestamp\n      localStorage.setItem('authTokenTime', Date.now().toString());\n      \n      // Update state immediately\n      setError(null);\n      setIsLoading(true);\n      \n      // Check auth status after a small delay\n      setTimeout(() => {\n        checkAuthStatus();\n      }, 200);\n      \n    } catch (err) {\n      console.error('Failed to store token:', err);\n      setError('Failed to store authentication');\n    }\n  };\n\n  const debugStorage = () => {\n    console.log('=== localStorage Debug ===');\n    console.log('localStorage available:', typeof(Storage) !== \"undefined\");\n    console.log('authToken:', localStorage.getItem('authToken'));\n    console.log('authTokenTime:', localStorage.getItem('authTokenTime'));\n    console.log('All localStorage keys:', Object.keys(localStorage));\n    console.log('========================');\n  };\n\n  return {\n    user,\n    isLoading,\n    error,\n    logout,\n    refreshAuth,\n    setAuthToken,\n    debugStorage,\n    isAuthenticated: !!user,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/pe/Project/nextjs/beta-bay/components/header.tsx"],"sourcesContent":["'use client'\n\nimport Link from 'next/link'\nimport React, { useState } from 'react'\nimport Image from 'next/image'\nimport { MdNotificationsNone } from \"react-icons/md\"\nimport { useAuth } from '@/hooks/useAuth'\n\nconst Header = () => {\n  const { user, logout, isAuthenticated } = useAuth();\n  const [showUserMenu, setShowUserMenu] = useState(false);\n\n  const handleLogout = async () => {\n    await logout();\n    setShowUserMenu(false);\n    window.location.href = '/';\n  };\n\n  return (\n    <div className='flex bg-white shadow-md items-center h-15 absolute w-full top-0 left-0 pl-2 pr-12 justify-between'>\n      <button className=\"flex items-center space-x-2\" onClick={() => window.location.href = '/'}>\n        <Image\n        src=\"https://placehold.co/200x50\"\n        alt=\"Logo\"\n        width={200}\n        height={50}\n      /></button>\n      <Link href=\"/explore\" className=\"px-4 py-2 hover:underline\">\n      Explore\n      </Link>\n      <Link href=\"/myapps\" className=\"px-4 py-2 hover:underline\">\n      My Apps\n      </Link>\n      <Link href=\"/joined\" className=\"px-4 py-2 hover:underline\">\n      Joined Tests\n      </Link>\n      <div className=\"flex max-w-xl items-center space-x-4\">\n      <div className=\"relative\">\n        <button \n          onClick={() => setShowUserMenu(!showUserMenu)} \n          className=\"relative\"\n        >\n          <MdNotificationsNone className=\"text-2xl\" />\n          <span className=\"absolute top-0 right-0 bg-red-400 text-black text-xs rounded-full px-1\">\n        3\n          </span>\n        </button>\n        {showUserMenu && (\n          <div className=\"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg py-2 z-50\">\n        <div className=\"px-4 py-2 text-sm text-gray-700 border-b\">\n          <div className=\"font-medium\">Notifications</div>\n        </div>\n        <ul className=\"max-h-48 overflow-y-auto\">\n          <li className=\"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\n            Notification 1\n          </li>\n          <li className=\"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\n            Notification 2\n          </li>\n          <li className=\"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\n            Notification 3\n          </li>\n        </ul>\n          </div>\n        )}\n      </div>\n      \n      {isAuthenticated && user ? (\n        <div className=\"relative\">\n          <button \n            onClick={() => setShowUserMenu(!showUserMenu)}\n            className=\"flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100\"\n          >\n            <img \n              src={user.image} \n              alt={user.name}\n              className=\"w-8 h-8 rounded-full\"\n            />\n            <span className=\"text-sm font-medium\">{user.name}</span>\n          </button>\n          \n          {showUserMenu && (\n            <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50\">\n              <div className=\"px-4 py-2 text-sm text-gray-700 border-b\">\n                <div className=\"font-medium\">{user.name}</div>\n                <div className=\"text-gray-500\">{user.email}</div>\n                <div className=\"text-xs text-gray-400\">{user.team}</div>\n              </div>\n              <button\n                onClick={handleLogout}\n                className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\"\n              >\n                Sign Out\n              </button>\n            </div>\n          )}\n        </div>\n      ) : (\n        <Link href=\"/signin\" className=\"px-4 py-2 hover:underline\">\n          Sign In\n        </Link>\n      )}\n      </div>\n    </div>\n  )\n}\n\nexport default Header"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;;;AANA;;;;;;AAQA,MAAM,SAAS;;IACb,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,eAAe,EAAE,GAAG,CAAA,GAAA,uJAAA,CAAA,UAAO,AAAD;IAChD,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,iMAAA,CAAA,WAAQ,AAAD,EAAE;IAEjD,MAAM,eAAe;QACnB,MAAM;QACN,gBAAgB;QAChB,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,qBACE,iOAAC;QAAI,WAAU;;0BACb,iOAAC;gBAAO,WAAU;gBAA8B,SAAS,IAAM,OAAO,QAAQ,CAAC,IAAI,GAAG;0BACpF,cAAA,iOAAC,oKAAA,CAAA,UAAK;oBACN,KAAI;oBACJ,KAAI;oBACJ,OAAO;oBACP,QAAQ;;;;;;;;;;;0BAEV,iOAAC,mMAAA,CAAA,UAAI;gBAAC,MAAK;gBAAW,WAAU;0BAA4B;;;;;;0BAG5D,iOAAC,mMAAA,CAAA,UAAI;gBAAC,MAAK;gBAAU,WAAU;0BAA4B;;;;;;0BAG3D,iOAAC,mMAAA,CAAA,UAAI;gBAAC,MAAK;gBAAU,WAAU;0BAA4B;;;;;;0BAG3D,iOAAC;gBAAI,WAAU;;kCACf,iOAAC;wBAAI,WAAU;;0CACb,iOAAC;gCACC,SAAS,IAAM,gBAAgB,CAAC;gCAChC,WAAU;;kDAEV,iOAAC,qLAAA,CAAA,sBAAmB;wCAAC,WAAU;;;;;;kDAC/B,iOAAC;wCAAK,WAAU;kDAAyE;;;;;;;;;;;;4BAI1F,8BACC,iOAAC;gCAAI,WAAU;;kDACjB,iOAAC;wCAAI,WAAU;kDACb,cAAA,iOAAC;4CAAI,WAAU;sDAAc;;;;;;;;;;;kDAE/B,iOAAC;wCAAG,WAAU;;0DACZ,iOAAC;gDAAG,WAAU;0DAAoD;;;;;;0DAGlE,iOAAC;gDAAG,WAAU;0DAAoD;;;;;;0DAGlE,iOAAC;gDAAG,WAAU;0DAAoD;;;;;;;;;;;;;;;;;;;;;;;;oBAQrE,mBAAmB,qBAClB,iOAAC;wBAAI,WAAU;;0CACb,iOAAC;gCACC,SAAS,IAAM,gBAAgB,CAAC;gCAChC,WAAU;;kDAEV,iOAAC;wCACC,KAAK,KAAK,KAAK;wCACf,KAAK,KAAK,IAAI;wCACd,WAAU;;;;;;kDAEZ,iOAAC;wCAAK,WAAU;kDAAuB,KAAK,IAAI;;;;;;;;;;;;4BAGjD,8BACC,iOAAC;gCAAI,WAAU;;kDACb,iOAAC;wCAAI,WAAU;;0DACb,iOAAC;gDAAI,WAAU;0DAAe,KAAK,IAAI;;;;;;0DACvC,iOAAC;gDAAI,WAAU;0DAAiB,KAAK,KAAK;;;;;;0DAC1C,iOAAC;gDAAI,WAAU;0DAAyB,KAAK,IAAI;;;;;;;;;;;;kDAEnD,iOAAC;wCACC,SAAS;wCACT,WAAU;kDACX;;;;;;;;;;;;;;;;;6CAOP,iOAAC,mMAAA,CAAA,UAAI;wBAAC,MAAK;wBAAU,WAAU;kCAA4B;;;;;;;;;;;;;;;;;;AAOnE;GAjGM;;QACsC,uJAAA,CAAA,UAAO;;;KAD7C;uCAmGS","debugId":null}}]
}