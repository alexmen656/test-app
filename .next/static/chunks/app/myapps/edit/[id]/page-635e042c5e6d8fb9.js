(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{1165:(e,t,s)=>{Promise.resolve().then(s.bind(s,8623))},1886:(e,t,s)=>{"use strict";s.d(t,{w:()=>r});var a=s(9509);function r(){return a.env.NEXT_PUBLIC_BACKEND_URL2||"https://betbay-backend.vercel.app"}},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},8623:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),r=s(2115),l=s(6766);let o=e=>{let{label:t,id:s,type:r="text",placeholder:l,value:o,onChange:n,as:i}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-600 mb-1",children:t}),"textarea"===i?(0,a.jsx)("textarea",{id:s,name:s,rows:4,className:"w-full px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:l,value:o,onChange:n}):(0,a.jsx)("input",{type:r,id:s,name:s,className:"w-full px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:l,value:o,onChange:n})]})},n=e=>{let{path:t,className:s="h-6 w-6"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:t})})},i=()=>(0,a.jsx)(n,{path:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",className:"h-8 w-8 text-gray-400"}),c=e=>{let{label:t,id:s,onChange:r,previewUrl:o,multiple:n=!1}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:t}),(0,a.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:(0,a.jsxs)("div",{className:"space-y-1 text-center",children:[o?(0,a.jsx)("div",{className:"mx-auto h-24 w-24 relative rounded-md overflow-hidden",children:(0,a.jsx)(l.default,{src:o,alt:"Preview",fill:!0,className:"object-cover"})}):(0,a.jsx)(i,{}),(0,a.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,a.jsxs)("label",{htmlFor:s,className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[(0,a.jsx)("span",{children:"Upload a file"}),(0,a.jsx)("input",{id:s,name:s,type:"file",className:"sr-only",onChange:r,multiple:n,accept:"image/*"})]}),(0,a.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]})};var d=s(5695),u=s(1886),p=s(9509);class m{async uploadFile(e,t){let s=new FormData;return s.append("file",e),new Promise((e,a)=>{let r=new XMLHttpRequest;t&&r.upload.addEventListener("progress",e=>{e.lengthComputable&&t({loaded:e.loaded,total:e.total,percentage:Math.round(e.loaded/e.total*100)})}),r.addEventListener("load",()=>{try{let t=JSON.parse(r.responseText);200===r.status&&t.success?e(t):a(Error(t.error||"Upload failed"))}catch(e){a(Error("Invalid server response"))}}),r.addEventListener("error",()=>{a(Error("Network error during upload"))}),r.open("POST","".concat(this.baseUrl,"/upload.php")),r.send(s)})}async uploadFiles(e,t,s){let a=[];for(let r=0;r<e.length;r++)try{let l=await this.uploadFile(e[r],e=>{t&&t(r,e)});a.push(l),s&&s(r,l)}catch(t){let e={success:!1,error:t instanceof Error?t.message:"Upload failed"};a.push(e),s&&s(r,e)}return a}async uploadFileSimple(e){let t=new FormData;t.append("file",e);try{let e=await fetch("".concat(this.baseUrl,"/upload.php"),{method:"POST",body:t}),s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"HTTP ".concat(e.status));return s}catch(e){throw Error(e instanceof Error?e.message:"Upload failed")}}validateFile(e,t){let s=(null==t?void 0:t.maxSize)||0x3200000,a=(null==t?void 0:t.allowedTypes)||["image/jpeg","image/jpg","image/png","image/gif","image/webp","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];return e.size>s?{valid:!1,error:"File too large. Maximum size is ".concat(Math.round(s/1024/1024),"MB")}:a.includes(e.type)?{valid:!0}:{valid:!1,error:"File type not allowed: ".concat(e.type)}}getFileInfo(e){return{name:e.name,size:e.size,type:e.type,lastModified:new Date(e.lastModified),sizeFormatted:this.formatFileSize(e.size)}}formatFileSize(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}constructor(e=p.env.NEXT_PUBLIC_UPLOAD_API_URL||"https://alex.polan.sk/betabay-backend"){this.baseUrl=e.replace(/\/$/,"")}}let h=new m,g=()=>{let[e,t]=(0,r.useState)(!1),[s,a]=(0,r.useState)(null);return{upload:(0,r.useCallback)(async e=>{t(!0),a(null);try{return(await h.uploadFileSimple(e)).url||null}catch(e){return a(e instanceof Error?e.message:"Upload failed"),null}finally{t(!1)}},[]),isUploading:e,error:s}},x=()=>{var e,t,s,n;let i=(0,d.useRouter)(),p=(0,d.useParams)(),m="new"!==p.id,[h,x]=(0,r.useState)({name:"",description:"",videoUrl:"",iosLink:"",androidLink:"",googleGroupLink:"",testingInstruction:"",price:0,icon:null,coverImage:null,screenshots:[]}),[b,f]=(0,r.useState)({screenshots:[]}),[y,v]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[N,_]=(0,r.useState)(null),[k,L]=(0,r.useState)({screenshots:[]}),{upload:U,isUploading:F}=g();(0,r.useEffect)(()=>{(async()=>{if(m){w(!0),_(null);try{let e=(0,u.w)(),t=p.id,s=localStorage.getItem("betabay_token"),a={};s&&(a.Authorization="Bearer ".concat(s));let r=await fetch("".concat(e,"/api/test-posts/").concat(t),{method:"GET",headers:a});if(!r.ok)throw Error("Failed to fetch app data: ".concat(r.status));let l=await r.json();console.log("Fetched app data:",l),x({name:l.name||l.app_name||"",description:l.description||"",videoUrl:l.videoUrl||l.youtube_link||"",iosLink:l.iosLink||l.ios_link||"",androidLink:l.androidLink||l.android_link||"",googleGroupLink:l.googleGroupLink||l.google_group_link||"",testingInstruction:l.testingInstruction||l.testing_instruction||"",price:"string"==typeof l.price?parseFloat(l.price):l.price||0,icon:null,coverImage:null,screenshots:[]});let o={screenshots:[]},n={screenshots:[]};if(l.iconUrl||l.icon_url){let e=l.iconUrl||l.icon_url;o.icon=e,n.icon=e}if(l.coverImageUrl||l.cover_image_url){let e=l.coverImageUrl||l.cover_image_url;o.coverImage=e,n.coverImage=e}if(Array.isArray(l.screenshots)||Array.isArray(l.screenshot_urls)){let e=l.screenshots||l.screenshot_urls||[];o.screenshots=e,n.screenshots=e}f(o),L(n)}catch(e){console.error("Error fetching app data:",e),_("Failed to load app data. Please try again.")}finally{w(!1)}}})()},[m,p.id]);let S=e=>{let{name:t,value:s,type:a}=e.target;x(e=>({...e,[t]:"number"===a?parseFloat(s):s}))},I=async e=>{let{name:t,files:s}=e.target;if(s&&0!==s.length)try{if("screenshots"===t){let e=Array.from(s),t=e.map(e=>URL.createObjectURL(e));f(e=>({...e,screenshots:[...e.screenshots,...t]}));let a=[];for(let t of e)try{let e=await U(t);e&&(a.push(e),console.log("Screenshot uploaded successfully:",e))}catch(e){console.error("Failed to upload screenshot:",e),alert("Failed to upload one of the screenshots. Please try again.");return}L(e=>({...e,screenshots:[...e.screenshots,...a]})),x(t=>({...t,screenshots:[...t.screenshots,...e]}))}else{let e=s[0],a=URL.createObjectURL(e);f(e=>({...e,[t]:a}));try{let s=await U(e);if(s)L(e=>({...e,[t]:s})),console.log("".concat(t," uploaded successfully:"),s);else throw Error("Upload failed - no URL returned")}catch(e){console.error("Failed to upload ".concat(t,":"),e),alert("Failed to upload ".concat(t,". Please try again.")),f(e=>({...e,[t]:void 0}));return}x(s=>({...s,[t]:e}))}}catch(e){console.error("File upload failed:",e),alert("File upload failed. Please try again.")}},P=async e=>{if(e.preventDefault(),!h.name.trim())return void alert("App Name is required.");if(F)return void alert("Please wait for all file uploads to complete before submitting.");v(!0);try{let e=(0,u.w)(),t={app_name:h.name,description:h.description,youtube_link:h.videoUrl,ios_link:h.iosLink,android_link:h.androidLink,google_group_link:h.googleGroupLink,testing_instruction:h.testingInstruction,test_price:h.price,user_info:{username:localStorage.getItem("betabay_username")||"test",profile_image:localStorage.getItem("betabay_profile_image")||"https://example.com/test",user_id:localStorage.getItem("betabay_user_id")||"test"},icon_url:k.icon||null,cover_image_url:k.coverImage||null,screenshot_urls:k.screenshots||[]};console.log("Sending file URLs to backend:",{icon_url:t.icon_url,cover_image_url:t.cover_image_url,screenshot_urls:t.screenshot_urls});let s=localStorage.getItem("betabay_token"),a={"Content-Type":"application/json"};s&&(a.Authorization="Bearer ".concat(s));let r=m?"".concat(e,"/api/test-posts/").concat(p.id):"".concat(e,"/api/test-posts"),l=m?"PUT":"POST",o=await fetch(r,{method:l,headers:a,body:JSON.stringify(t)});if(!o.ok)throw Error("Error ".concat(m?"updating":"creating"," app: ").concat(o.status));let n=await o.json();console.log("App ".concat(m?"updated":"created"," successfully:"),n),i.push("/myapps")}catch(e){console.error("Failed to ".concat(m?"update":"create"," app:"),e),alert("Failed to ".concat(m?"update":"create"," app. Please try again."))}finally{v(!1)}};return(0,a.jsxs)("div",{className:"max-w-5xl mx-auto md:px-5 px-2 mb-10",children:[(0,a.jsxs)("header",{className:"my-10 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-800",children:m?"Edit App":"Post a New App"}),(0,a.jsx)("p",{className:"text-gray-500 mt-1",children:m?"Update the details below to modify your app information.":"Fill in the details below to get your app ready for testing."})]}),m&&(0,a.jsx)("button",{onClick:()=>i.push("/detail/".concat(p.id)),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"View Details"})]}),j?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("p",{className:"ml-3 text-lg text-gray-600",children:"Loading app data..."})]}):N?(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-6",children:[(0,a.jsx)("p",{className:"font-medium",children:"Error"}),(0,a.jsx)("p",{children:N}),(0,a.jsx)("button",{onClick:()=>i.push("/myapps"),className:"mt-2 px-4 py-2 bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"Return to My Apps"})]}):(0,a.jsxs)("form",{onSubmit:P,className:"space-y-12",children:[F&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-md mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-blue-500 mr-3"}),(0,a.jsx)("p",{className:"font-medium",children:"Uploading files..."})]}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Please wait while your files are being uploaded."})]}),(0,a.jsxs)("div",{className:"p-8 bg-white border border-gray-200 rounded-2xl shadow-sm",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-6",children:"Core Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(c,{label:"App Icon",id:"icon",onChange:I,previewUrl:b.icon}),k.icon&&(0,a.jsx)("div",{className:"mt-2 text-sm text-green-600",children:"✅ Icon uploaded successfully"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,a.jsx)(o,{label:"App Name",id:"name",placeholder:"My Awesome App",value:h.name,onChange:S}),(0,a.jsx)(o,{label:"Description",id:"description",as:"textarea",placeholder:"A brief, catchy description of your app.",value:h.description,onChange:S})]})]})]}),(0,a.jsxs)("div",{className:"p-8 bg-white border border-gray-200 rounded-2xl shadow-sm",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-6",children:"Media & Visuals"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{label:"Cover Image",id:"coverImage",onChange:I,previewUrl:b.coverImage}),k.coverImage&&(0,a.jsx)("div",{className:"mt-2 text-sm text-green-600",children:"✅ Cover image uploaded successfully"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{label:"Screenshots (Select multiple)",id:"screenshots",onChange:I,multiple:!0}),k.screenshots.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["✅ ",k.screenshots.length," screenshot(s) uploaded successfully"]})]}),b.screenshots.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:b.screenshots.map((e,t)=>(0,a.jsx)("div",{className:"relative w-full aspect-square rounded-md overflow-hidden",children:(0,a.jsx)(l.default,{src:e,fill:!0,className:"object-cover",alt:"Screenshot ".concat(t+1)})},t))}),(0,a.jsx)(o,{label:"YouTube Link (Optional)",id:"videoUrl",placeholder:"https://youtube.com/watch?v=...",value:null!=(e=h.videoUrl)?e:"",onChange:S})]})]}),(0,a.jsxs)("div",{className:"p-8 bg-white border border-gray-200 rounded-2xl shadow-sm",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-6",children:"Testing & Distribution"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(o,{label:"iOS Test Link (TestFlight)",id:"iosLink",placeholder:"https://testflight.apple.com/join/...",value:null!=(t=h.iosLink)?t:"",onChange:S}),(0,a.jsx)(o,{label:"Android Test Link (Play Store)",id:"androidLink",placeholder:"https://play.google.com/apps/testing/...",value:null!=(s=h.androidLink)?s:"",onChange:S}),(0,a.jsx)(o,{label:"Google Group Link (Optional)",id:"googleGroupLink",placeholder:"https://groups.google.com/g/...",value:null!=(n=h.googleGroupLink)?n:"",onChange:S}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(o,{label:"Testing Instructions",id:"testingInstruction",as:"textarea",placeholder:"e.g., 'Log in with user: test@test.com, pass: 1234. Then, navigate to the dashboard and try creating a new project.'",value:h.testingInstruction,onChange:S})}),(0,a.jsx)(o,{label:"Reward ($)",id:"price",type:"number",placeholder:"0.00",value:h.price,onChange:S})]})]}),(0,a.jsxs)("div",{className:"flex justify-end items-center gap-4 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{i.push("/myapps")},disabled:y,className:"px-6 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:y||F,className:"px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transform hover:scale-105 transition disabled:opacity-50 disabled:transform-none",children:F?"Uploading files...":y?m?"Updating...":"Posting...":m?"Update App":"Post App"})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[766,441,684,358],()=>t(1165)),_N_E=e.O()}]);